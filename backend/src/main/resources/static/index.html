<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ì  JSON POST ìš”ì²­ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; padding: 20px; max-width: 700px; margin: auto; }
        .container { background-color: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 25px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="number"], input[type="datetime-local"] { width: 95%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 20px; font-size: 1rem; color: #fff; background-color: #007bff; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .participant-entry { border: 1px dashed #007bff; padding: 15px; margin-top: 15px; border-radius: 5px; position: relative; }
        .add-btn { background-color: #28a745; margin-top: 10px; }
        .add-btn:hover { background-color: #218838; }
        .remove-btn { position: absolute; top: 10px; right: 10px; background-color: #dc3545; color: white; border: none; border-radius: 50%; width: 25px; height: 25px; cursor: pointer; font-weight: bold; line-height: 25px; text-align: center; }
        #submit-btn { background-color: #17a2b8; margin-top: 20px; width: 100%; }
        #submit-btn:hover { background-color: #138496; }
    </style>
</head>
<body>

<div class="container">
    <h1>ì •ì‚° ì •ë³´ ì „ì†¡ (ë™ì  í¼) ğŸ“</h1>

    <fieldset>
        <legend><h3>ì •ì‚° ì •ë³´</h3></legend>
        <div class="form-group">
            <label for="title">ì œëª©</label>
            <input type="text" id="title" value="8ì›” íŒ€ ì ì‹¬ ì‹ì‚¬">
        </div>
        <div class="form-group">
            <label for="description">ì„¤ëª…</label>
            <input type="text" id="description" value="ì„œì´ˆì—­ ê·¼ì²˜ ë§›ì§‘">
        </div>
        <div class="form-group">
            <label for="hostMemberId">ì£¼ìµœì ID</label>
            <input type="number" id="hostMemberId" value="101">
        </div>
        <div class="form-group">
            <label for="deadline">ë§ˆê°ì¼</label>
            <input type="datetime-local" id="deadline">
        </div>
    </fieldset>

    <fieldset>
        <legend><h3>ì°¸ì—¬ì ì •ë³´</h3></legend>
        <div id="participants-container"></div>
        <button type="button" id="add-participant-btn" class="add-btn">+ ì°¸ì—¬ì ì¶”ê°€</button>
    </fieldset>

    <button type="button" id="submit-btn">ìµœì¢… ì •ì‚° ì •ë³´ ì „ì†¡ (JSON)</button>
</div>

<script>
    // --- ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
    const addParticipantBtn = document.getElementById('add-participant-btn');
    const participantsContainer = document.getElementById('participants-container');
    const submitBtn = document.getElementById('submit-btn');

    // --- ì°¸ì—¬ì ì¶”ê°€ ê¸°ëŠ¥ ---
    addParticipantBtn.addEventListener('click', () => {
        // ìƒˆë¡œìš´ ì°¸ì—¬ì ì…ë ¥ í¼ì„ ë‹´ì„ div ìƒì„±
        const participantEntry = document.createElement('div');
        participantEntry.className = 'participant-entry';

        // ê° í•„ë“œì— ëŒ€í•œ HTML ë‚´ë¶€ êµ¬ì¡° ì„¤ì •
        participantEntry.innerHTML = `
            <button type="button" class="remove-btn" onclick="removeParticipant(this)">X</button>
            <div class="form-group">
                <label>ì°¸ì—¬ì ID (Kakao ID)<- ì“°ì§€ë§ˆì‹­ì‡¼, ì‚¬ë¼ì§„ê°’</label>
                <input type="number" name="participant_id" placeholder="ì˜ˆ: 201">
            </div>
            <div class="form-group">
                <label>UUID</label>
                <input type="number" name="participant_uuid" placeholder="ì˜ˆ: 12345">
            </div>
            <div class="form-group">
                <label>ì´ë¦„</label>
                <input type="text" name="participant_name" placeholder="ì˜ˆ: ê¹€ì •ì‚°">
            </div>
            <div class="form-group">
                <label>ì¸ë„¤ì¼ URL</label>
                <input type="text" name="participant_thumbnailUrl" placeholder="http://...">
            </div>
        `;

        // ì»¨í…Œì´ë„ˆì— ìƒˆë¡œ ë§Œë“  í¼ ì¶”ê°€
        participantsContainer.appendChild(participantEntry);
    });

    // --- ì°¸ì—¬ì ì‚­ì œ ê¸°ëŠ¥ ---
    function removeParticipant(button) {
        // 'X' ë²„íŠ¼ì˜ ë¶€ëª¨ ìš”ì†Œì¸ .participant-entry divë¥¼ ì°¾ì•„ì„œ ì‚­ì œ
        button.closest('.participant-entry').remove();
    }

    // --- ìµœì¢… ë°ì´í„° ì œì¶œ ê¸°ëŠ¥ ---
    submitBtn.addEventListener('click', async () => {
        // 1. ì •ì‚°(Settlement) ê¸°ë³¸ ì •ë³´ ìˆ˜ì§‘
        const settlementData = {
            title: document.getElementById('title').value,
            description: document.getElementById('description').value,
            hostMemberId: parseInt(document.getElementById('hostMemberId').value, 10),
            deadline: document.getElementById('deadline').value ? document.getElementById('deadline').value : null
        };

        // 2. ë™ì ìœ¼ë¡œ ì¶”ê°€ëœ ì°¸ì—¬ì(Participant) ì •ë³´ ìˆ˜ì§‘
        const participantsArray = [];
        const participantEntries = document.querySelectorAll('.participant-entry');

        participantEntries.forEach(entry => {
            const participant = {
                id: parseInt(entry.querySelector('[name=participant_id]').value, 10) || null,
                uuid: parseInt(entry.querySelector('[name=participant_uuid]').value, 10) || null,
                name: entry.querySelector('[name=participant_name]').value,
                thumbnailUrl: entry.querySelector('[name=participant_thumbnailUrl]').value
            };
            participantsArray.push(participant);
        });

        // 3. ì •ì‚° ì •ë³´ì™€ ì°¸ì—¬ì ì •ë³´ë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ í•©ì¹¨
        const finalPayload = {
            ...settlementData,
            participants: participantsArray
        };

        console.log('ì „ì†¡í•  ìµœì¢… JSON ë°ì´í„°:', finalPayload);

        // 4. fetch APIë¡œ ì„œë²„ì— ë°ì´í„° ì „ì†¡
        try {
            const response = await fetch('http://localhost:8080/settlement', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(finalPayload)
            });

            const resultText = await response.text();
            alert(`ìš”ì²­ ì„±ê³µ!\n\nStatus: ${response.status}\nResponse:\n${resultText}`);
        } catch (error) {
            console.error('ìš”ì²­ ì‹¤íŒ¨:', error);
            alert('ìš”ì²­ ì‹¤íŒ¨! ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
        }
    });
</script>

</body>
</html>